(function(a){if(typeof define==="function"&&define.amd){define(["jquery","angular","./jquery.fileupload-image","./jquery.fileupload-audio","./jquery.fileupload-video","./jquery.fileupload-validate"],a)}else{a()}}(function(){angular.module("blueimp.fileupload",[]).provider("fileUpload",function(){var c=function(e){var d=angular.element(this).fileupload("option","scope");d.$evalAsync(e)},a=function(e,g){var f=g.files,d=f[0];angular.forEach(f,function(i,h){i._index=h;i.$state=function(){return g.state()};i.$processing=function(){return g.processing()};i.$progress=function(){return g.progress()};i.$response=function(){return g.response()}});d.$submit=function(){if(!d.error){return g.submit()}};d.$cancel=function(){return g.abort()}},b;b=this.defaults={handleResponse:function(g,f){var d=f.result&&f.result.files;if(d){f.scope.replace(f.files,d)}else{if(f.errorThrown||f.textStatus==="error"){f.files[0].error=f.errorThrown||f.textStatus}}},add:function(h,g){if(h.isDefaultPrevented()){return false}var f=g.scope,d=[];angular.forEach(g.files,function(e){d.push(e)});f.$apply(function(){a(f,g);var e=f.option("prependFiles")?"unshift":"push";Array.prototype[e].apply(f.queue,g.files)});g.process(function(){return f.process(g)}).always(function(){f.$apply(function(){a(f,g);f.replace(d,g.files)})}).then(function(){if((f.option("autoUpload")||g.autoUpload)&&g.autoUpload!==false){g.submit()}})},progress:function(f,d){if(f.isDefaultPrevented()){return false}d.scope.$apply()},done:function(g,f){if(g.isDefaultPrevented()){return false}var d=this;f.scope.$apply(function(){f.handleResponse.call(d,g,f)})},fail:function(h,g){if(h.isDefaultPrevented()){return false}var f=this,d=g.scope;if(g.errorThrown==="abort"){d.clear(g.files);return}d.$apply(function(){g.handleResponse.call(f,h,g)})},stop:c,processstart:c,processstop:c,getNumberOfFiles:function(){var d=this.scope;return d.queue.length-d.processing()},dataType:"json",autoUpload:false};this.$get=[function(){return{defaults:b}}]}).provider("formatFileSizeFilter",function(){var a={units:[{size:1000000000,suffix:" GB"},{size:1000000,suffix:" MB"},{size:1000,suffix:" KB"}]};this.defaults=a;this.$get=function(){return function(b){if(!angular.isNumber(b)){return""}var d=true,c=0,e,f;while(d){d=a.units[c];e=d.prefix||"";f=d.suffix||"";if(c===a.units.length-1||b>=d.size){return e+(b/d.size).toFixed(2)+f}++c}}}}).controller("FileUploadController",["$rootScope","$scope","$element","$attrs","fileUpload","VulpeJS",function(b,e,c,a,g,d){var f=new d().init();var h={progress:function(){return c.fileupload("progress")},active:function(){return c.fileupload("active")},option:function(i,j){if(arguments.length===1){return c.fileupload("option",i)}c.fileupload("option",i,j)},add:function(i){return c.fileupload("add",i)},send:function(i){return c.fileupload("send",i)},process:function(i){return c.fileupload("process",i)},processing:function(i){return c.fileupload("processing",i)}};e.disabled=!f.$window.jQuery.support.fileInput;b.queue=b.queue||[];e.clear=function(n){var j=this.queue,l=j.length,k=n,m=1;if(angular.isArray(n)){k=n[0];m=n.length}while(l){--l;if(j[l]===k){return j.splice(l,m)}}};e.replace=function(l,p){var k=this.queue,o=l[0];for(var n=0;n<k.length;++n){if(k[n]===o){for(var m=0;m<p.length;++m){k[n+m]=p[m]}return}}};e.applyOnQueue=function(m){var l=this.queue.slice(0);for(var k=0;k<l.length;++k){var j=l[k];if(j[m]){j[m]()}}};e.submit=function(){this.applyOnQueue("$submit")};e.cancel=function(){f.dialog.confirm({message:"Do you really want to cancel the upload?",callback:function(i){e.applyOnQueue("$cancel")}})};e.removeAll=function(){f.dialog.confirm({message:"Do you really want to delete all selected files?",callback:function(i){f.ui.uploader.removeAll()}})};angular.extend(e,h);c.fileupload(angular.extend({scope:e},g.defaults)).on("fileuploadadd",function(j,i){i.scope=e;f.ui.uploader.on.submit()}).on("fileuploadfail",function(j,i){if(i.errorThrown==="abort"){return}if(i.dataType&&i.dataType.indexOf("json")===i.dataType.length-4){try{i.result=angular.fromJson(i.jqXHR.responseText)}catch(k){}}}).on("fileuploadsubmit",function(j,i){f.ui.uploader.on.submit()}).on(["fileuploadadd","fileuploadsubmit","fileuploadsend","fileuploaddone","fileuploadfail","fileuploadalways","fileuploadprogress","fileuploadprogressall","fileuploadstart","fileuploadstop","fileuploadchange","fileuploadpaste","fileuploaddrop","fileuploaddragover","fileuploadchunksend","fileuploadchunkdone","fileuploadchunkfail","fileuploadchunkalways","fileuploadprocessstart","fileuploadprocess","fileuploadprocessdone","fileuploadprocessfail","fileuploadprocessalways","fileuploadprocessstop"].join(" "),function(j,i){if(i&&i.files){i.files.forEach(function(k){if(k.error){k.error=f.i18n(k.error)}})}if(e.$emit(j.type,i).defaultPrevented){j.preventDefault()}}).on("remove",function(){var i;for(i in h){if(h.hasOwnProperty(i)){delete e[i]}}});e.$watch(a.fileUpload,function(i){if(i){c.fileupload("option",i)}})}]).controller("FileUploadProgressController",["$scope","$attrs","$parse",function(b,a,d){var c=d(a.fileUploadProgress),e=function(){var f=c(b);if(!f||!f.total){return}b.num=Math.floor(f.loaded/f.total*100)};e();b.$watch(a.fileUploadProgress+".loaded",function(g,f){if(g!==f){e()}})}]).controller("FileUploadPreviewController",["$scope","$element","$attrs",function(c,b,a){c.$watch(a.fileUploadPreview+".preview",function(e){b.empty();if(e){if(e.type&&e.type==="video"){var d=document.createElement("video");d.src=e.src;d.controls=true;e=d}b.append(e)}})}]).directive("fileUpload",function(){return{controller:"FileUploadController",scope:true}}).directive("fileUploadProgress",function(){return{controller:"FileUploadProgressController",scope:true}}).directive("fileUploadPreview",function(){return{controller:"FileUploadPreviewController"}}).directive("download",function(){return function(a,b){b.on("dragstart",function(c){try{c.originalEvent.dataTransfer.setData("DownloadURL",["application/octet-stream",b.prop("download"),b.prop("href")].join(":"))}catch(d){}})}})}));