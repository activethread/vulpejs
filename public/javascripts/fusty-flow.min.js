!function(e,t,i){"use strict";function n(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i}function r(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent?e.detachEvent("on"+t,i):e["on"+t]=null}function o(e){e.parentNode.removeChild(e)}function s(e){var t={};return e&&"[object Function]"===t.toString.call(e)}function a(t){this.support=!1,this.files=[],this.events=[],this.defaults={simultaneousUploads:3,fileParameterName:"file",query:{},target:"/",generateUniqueIdentifier:null,matchJSON:!1};var i=this;this.inputChangeEvent=function(e){var t=e.srcElement;r(t,"change",i.inputChangeEvent);var o=t.cloneNode(!1);t.parentNode.replaceChild(o,t),i.addFile(t,e),o.value="",n(o,"change",i.inputChangeEvent)},this.opts=e.extend({},this.defaults,t||{})}function u(e,t){this.flowObj=e,this.element=t,this.name=t.value&&t.value.replace(/.*(\/|\\)/,""),this.relativePath=this.name,this.uniqueIdentifier=e.generateUniqueIdentifier(t),this.iFrame=null,this.finished=!1,this.error=!1;var i=this;this.iFrameLoaded=function(){if(i.iFrame&&i.iFrame.parentNode){i.finished=!0;try{if(i.iFrame.contentDocument&&i.iFrame.contentDocument.body&&"false"==i.iFrame.contentDocument.body.innerHTML)return}catch(e){return i.error=!0,i.abort(),void i.flowObj.fire("fileError",i,e)}var t=i.iFrame.contentDocument||i.iFrame.contentWindow.document,n=t.body.innerHTML;i.flowObj.opts.matchJSON&&(n=/(\{.*\})/.exec(n)[0]),i.abort(),i.flowObj.fire("fileSuccess",i,n),i.flowObj.upload()}},this.bootstrap()}var f=e.extend,l=e.each;a.prototype={on:e.prototype.on,fire:e.prototype.fire,cancel:e.prototype.cancel,assignBrowse:function(e){"undefined"==typeof e.length&&(e=[e]),l(e,function(e){var t;"INPUT"===e.tagName&&"file"===e.type?t=e:(t=i.createElement("input"),t.setAttribute("type","file"),f(e.style,{display:"inline-block",position:"relative",overflow:"hidden",verticalAlign:"top"}),f(t.style,{position:"absolute",top:0,right:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,opacity:0,filter:"alpha(opacity=0)",cursor:"pointer"}),e.appendChild(t)),n(t,"change",this.inputChangeEvent)},this)},assignDrop:function(){},unAssignDrop:function(){},isUploading:function(){var e=!1;return l(this.files,function(t){return t.isUploading()?(e=!0,!1):void 0}),e},upload:function(){var e=0;l(this.files,function(t){if(1!=t.progress()){if(t.isUploading())return void e++;if(e++>=this.opts.simultaneousUploads)return!1;1==e&&this.fire("uploadStart"),t.send()}},this),e||this.fire("complete")},pause:function(){l(this.files,function(e){e.abort()})},resume:function(){this.upload()},progress:function(){var e=0,t=0;return l(this.files,function(i){e+=i.progress(),t++}),t>0?e/t:0},addFiles:function(e,t){var i=[];l(e,function(e){if(1===e.nodeType&&e.value){var n=new u(this,e);this.fire("fileAdded",n,t)&&i.push(n)}},this),this.fire("filesAdded",i,t)&&l(i,function(e){this.opts.singleFile&&this.files.length>0&&this.removeFile(this.files[0]),this.files.push(e)},this),this.fire("filesSubmitted",i,t)},addFile:function(e,t){this.addFiles([e],t)},generateUniqueIdentifier:function(e){var t=this.opts.generateUniqueIdentifier;return"function"==typeof t?t(e):"xxxxxxxx-xxxx-yxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)})},getFromUniqueIdentifier:function(e){var t=!1;return l(this.files,function(i){i.uniqueIdentifier==e&&(t=i)}),t},removeFile:function(e){for(var t=this.files.length-1;t>=0;t--)this.files[t]===e&&this.files.splice(t,1)},getSize:function(){},timeRemaining:function(){},sizeUploaded:function(){}},u.prototype={getExtension:e.FlowFile.prototype.getExtension,getType:function(){},send:function(){if(!this.finished){var e=this.flowObj.opts,t=this.createForm(),i=e.query;s(i)&&(i=i(this)),i[e.fileParameterName]=this.element,i.flowFilename=this.name,i.flowRelativePath=this.relativePath,i.flowIdentifier=this.uniqueIdentifier,this.addFormParams(t,i),n(this.iFrame,"load",this.iFrameLoaded),t.submit(),o(t)}},abort:function(){this.iFrame&&(this.iFrame.setAttribute("src","java"+String.fromCharCode(115)+"cript:false;"),o(this.iFrame),this.iFrame=null)},cancel:function(){this.abort(),this.flowObj.removeFile(this)},retry:function(){this.bootstrap(),this.flowObj.upload()},bootstrap:function(){this.abort(),this.error=!1},timeRemaining:function(){},sizeUploaded:function(){},resume:function(){this.flowObj.upload()},pause:function(){this.abort()},isUploading:function(){return null!==this.iFrame},isComplete:function(){return 1===this.progress()},progress:function(){return this.error?1:this.finished?1:0},createIframe:function(){var e=i.createElement(/MSIE (6|7|8)/.test(navigator.userAgent)?'<iframe name="'+this.uniqueIdentifier+'_iframe">':"iframe");return e.setAttribute("id",this.uniqueIdentifier+"_iframe_id"),e.setAttribute("name",this.uniqueIdentifier+"_iframe"),e.style.display="none",i.body.appendChild(e),e},createForm:function(){var e=this.flowObj.opts.target,t=i.createElement("form");return t.encoding="multipart/form-data",t.method="POST",t.setAttribute("action",e),this.iFrame||(this.iFrame=this.createIframe()),t.setAttribute("target",this.iFrame.name),t.style.display="none",i.body.appendChild(t),t},addFormParams:function(e,t){var n;l(t,function(t,r){t&&1===t.nodeType?n=t:(n=i.createElement("input"),n.setAttribute("value",t)),n.setAttribute("name",r),e.appendChild(n)})}},a.FustyFlowFile=u,"undefined"!=typeof module?module.exports=a:"function"==typeof define&&define.amd?define(function(){return a}):t.FustyFlow=a}(window.Flow,window,document);